\chapter{Matrices de datos}
\label{cha:matrices}
\index{Car\'acter!Codificaci\'on} 

\section*{Introducci\'on}

Una de las diferencias m\'as importantes entre los trabajos taxon\'omicos con un enfoque \textbf{cl\'asico} y los an\'alisis filogen\'eticos es que estos \'ultimos incluyen expl\'icitamente una matriz de datos donde se pueden evidenciar los caracteres examinados, y c\'omo fueron interpretados.

B\'asicamente, la matriz de datos es una lista tabulada de las observaciones de los caracteres en los distintos taxa. Para facilitar su lectura y su uso en programas de an\'alisis filogen\'etico, los caracteres y sus estados son codificados como n\'umeros o como letras.

Una vez construida, la matriz es el punto de partida para la b\'usqueda de \'arboles y la manera m\'as sencilla con la que otros investigadores pueden recuperar la informaci\'on recopilada durante el \textbf{an\'alisis de caracteres}.\footnote{si desea puede ver nuestra visi\'on ampliada en \cite{Mirandaetal2004}.}

Tal y como se hizo en la pr\'actica sobre selecci\'on de caracteres, lo que se busca es que el investigador sea consistente en la codificaci\'on de los caracteres, lo cual es importante en el manejo de caracteres inaplicables y no observados. Algunos autores los codifican de diferentes formas en la matriz (usualmente, con \textbf {-} y \textbf {?}) para facilitar la recuperaci\'on de informaci\'on (puede encontrar una discusi\'on m\'as completa en \cite{Strong1999}), otros autores, y en general los programas, no reconocen diferencia entre unos y otros, mientras que programas como \Pname{TNT}, \Pname{POY} o \Pname{PAUP*} pueden reconocer los eventos de inserci\'on-p\'erdida como un quinto car\'acter o como gaps \citep{Giribet1999}.

Cuando se usan caracteres con m\'ultiples estados, es necesario {cla}{ri}{fi}{car} cu\'ales fueron usados como aditivos y cu\'ales como no aditivos, y en el caso de haber sido recodificados, c\'omo se hizo esa codificaci\'on. 
Si se han codificado como aditivos, se debe indicar el ?`por qu\'e? de tal codificaci\'on e incluir los argumentos que muestren que los estados de car\'acter se hallan anidados entre s\'i, la aditividad puede generar la estructura en la topolog\'ia final, sin que haya realmente transformaciones que soporten los nodos.

\section*{T\'ecnicas}

Existen diferentes programas para manipular matrices de datos y \'arboles. Algunos de ellos permiten la interacci\'on matriz-\'arbol 
(\Pname{WinClada}\footnote{\url{www.cladistics.com}}, 
\Pname{Mesquite}\footnote{\url{www.mesquiteproject.org}}, 
\Pname{MacClade}\footnote{el programa no corre en versiones de MacOS X superiores a 10.6 (desde Lion en adelante)}, 
\Pname{R}\footnote{\Pname{R} es uno de los programas para an\'alisis estad\'istico m\'as vers\'atiles, adem\'as de ser gratuito permite la implementaci\'on de m\'ultiples procesos de c\'alculo desde estad\'istica b\'asica hasta m\'ultiples an\'alisis en evoluci\'on; sirve de plataforma para \Rlib{ape} \cite{Paradis2008}, una biblioteca que permite distintas acciones con matrices y \'arboles. El programa se puede obtener desde \url{http://cran.r-project.org}.}
o 
\Pname{Seaview}\footnote{\url{http://doua.prabi.fr/software/seaview}}). 

En su mayor\'ia estos programas sirven de plataforma para manejar otros programas que realizan el an\'alisis filogen\'etico como tal. Muchos de los programas que manejan matrices est\'an dise\~nados b\'asicamente para alg\'un tipo particular de datos (por ejemplo, ADN) y aquellos que tienen un marco amplio se quedan cortos para manejar cierta clase de informaci\'on (por ejemplo, no interpretan la codificaci\'on IUPAC para polimorfismos de ADN).

Los programas pueden leer uno o varios formatos de archivos, pero solo algunos programas como \Pname{Mesquite} leen y escriben todos los formatos de datos; es importante revisar la compatibilidad de los programas para el manejo de archivos. En la mayor\'ia de ellos es posible exportar entre los diferentes tipos de datos, o por lo menos entre los m\'as usados. En general, la mayor parte de los programas trabaja bien con el formato NEXUS \citep{Maddison1997}, tanto para exportar como para importar, aunque el formato es en ocasiones muy diferente y algunos programas pueden no identificarlo correctamente. 

Otro formato importante es el de Hennig86 o NONA, pero en muchos programas, especialmente moleculares, su uso no est\'a implementado.

Se han hecho algunos ejercicios de extender XML, un lenguaje de marcas, para que sea posible usarlo en an\'alisis filogen\'eticos\footnote{\url{www.phyloxml.org}}, se busca en \'ultima instancia que los an\'alisis filog\'eticos cumplan con los est\'andares de reproductibilidad (ver por ejemplo \cite{Cranston2014}).

Revise siempre la documentaci\'on del programa que desea usar y as\'i podr\'a estar seguro si el programa que va a utilizar cumple con los requisitos que usted necesita y cual es el formato de las matrices.

Existen listas de programas para an\'alisis filogen\'etico que pueden ser consultadas en internet, por ejemplo:


\url{http://evolution.genetics.washington.edu/phylip/software.html}
 
o en 

\url{http://taxonomy.zoology.gla.ac.uk/software/}


Abra el archivo de datos morfol\'ogicos para vertebrados: \Datos{\href{https://github.com/Dmirandae/siste-manual-v2/blob/master/ejercicios/Practica02_matrices/datos/datos.vertebrados.xls}{datosVertebrados.xls}} con un programa para hojas de c\'alculo. Para manipular las matrices para an\'alisis filogen\'etico use \Pname{WinClada}, 
\Pname{Mesquite} o \Pname{TNT} para Windows.

Realice las siguientes actividades:

\begin{enumerate}
	\item Anote cu\'ales caracteres son multiestado y cu\'ales son binarios.

	\item Identifique si hay o no caracteres aditivos.

	\item A partir de los datos, construya una matriz nueva (en \Pname{TNT} para Windows use el men\'u \Gui{Data - edit data}). 

	\item Dado que los programas no cuentan con opciones de salvado autom\'atico, peri\'odicamente salve la matriz.

	\item Nomine los terminales y los caracteres y sus estados. Explore diferentes formas en las que puede hacerlo. 

	\item Algunos autores consideran que las plumas son escamas modificadas. Aceptando esa informaci\'on, recodifique la matriz y determine si el car\'acter es aditivo o no.

	\item Seleccione el \'ultimo car\'acter y col\'oquelo al principio de la matriz. 

	\item Introduzca un car\'acter nuevo en la posici\'on 4.

	\item Exporte la matriz en otros formatos, \Fname{NEXUS} si est\'a usando \Pname{WinClada}, \Fname{Nona} si est\'a usando \Pname{Mesquite}.

	\item Verifique la compatibilidad de los datos, abriendo la matriz en el programa correspondiente.

	\item Revise con un editor de texto los archivos que usted cre\'o, trate de identificar cu\'ales son las partes claves del formato\footnote{Aunque en general no se usan los editores de texto, este paso es cr\'itico para despu\'es poder rastrear los problemas que pueden tener las matrices de datos.}.

	\item Abra una de las matrices moleculares en cada programa y con un editor de texto y trate de identificar en qu\'e se diferencia(n) de la matriz morfol\'ogica.

	\item en \Pname{R}:
	\begin{enumerate}
		\item Instale en su ordenador la versi\'on m\'as reciente de R ($\ge$ 3.3.3). 

		\item Carge las bibliotecas \Rlib{ape} y \Rlib{phangorn}\footnote{La biblioteca \Rlib{phangorn} est\'a diseñada para an\'alisis filogen\'eticos que tiene como objetivo estimar \'arboles y redes, utilizando diferentes m\'etodos como m\'axima verosimilitud, parsimonia, distancia y conjugaci\'on de Handamard, requiere las bibliotecas \Rlib{ape} y \Rlib{rgl}. 
		Puede ser descargado desde \url{http://cran.r-project.org/web/packages/phangorn/index.html}}: 
		\Cmd{library(phangorn)}

		\item En caso de no tener las bibliotecas disponibles primero b\'ajelas con la instrucci\'on
		\footnote{La funci\'on \Rfunc{install.packages($"$Nombre\_paquete$"$)} permite hacer la descarga de los paquetes directamente del repositorio desde el entorno de R. Tambi\'en es posible hacer la descarga directamente de la p\'agina web e instalarlo desde cualquier directorio en el ordenador dando directamente la ruta a dicho sitio: 
		\cmd{install.packages ($"$../usuario/R/Packages/Paquete.tar.gz$"$)}, 
		pero deberá descargar e instalar, independiente, todas las dependencias requeridas por el paquete. La instrucci\'on \cmd{library()} le permitir\'a cargar el paquete en el entorno de R para poder empezar a trabajar con todas sus utilidades.}
		:
		\Cmd{install.packages(c($"$ape$"$, $"$phangorn$"$), 
		dependencies=T)}

		\item Abra la matriz de datos en formato de texto simple y as\'ignela a un objeto de \Pname{R}: 
		\Cmd{ datos $<-$ read.table($"$matriz.txt$"$)}

		\item Revise los nombres de las variables en la matriz con
		\cmd{names(datos)}

		\item Revise los nombres de las terminales en la matriz con
		\cmd{row.names(datos)}

		\item Abra la matriz de datos en formato \Fname{phylip/newick} y as\'ignela a un objeto de \Pname{R}: 
		\Cmd{datos.Phylip $<-$ read.phyDat($"$DNA1.phy$"$, 
		format=$"$phylip$"$, type=$"$DNA$"$)} 

		\item Escriba en formato \Fname{Nexus} la matriz le\'ida \Rdatos{datos}:
		\Cmd{write.nexus.data(datos.Phylip, 
		file=$"$DNA1.nex$"$)}

		\item Abra la matriz escrita con \Pname{Winclada} o \Pname{Mesquite} y revise la conversi\'on.
	\end{enumerate}

	\item En el directorio de datos existen dos matrices con distintos problemas \Datos{problema1.txt} y \Datos{problema2.txt}, intente abrir las matrices, busque y corrija el error.\footnote{tradicionalmente, las terminaciones de los archivos son .ss en \Pname{WinClada}, .nex con \Pname{Mesquite} o \Pname{MacClade}, pero \textbf{debe} recordar que la terminaci\'on del archivo no es necesariamente el formato.}

\end{enumerate} 


Dependiendo de la plataforma que trabaje, usted tiene disponible distintos programas. \Pname{Mesquite} y \Pname{R} son programas gratuitos y v\'alidos para todas las plataformas pero en general las b\'usquedas no son eficientes, aunque le permiten trabajar con varios tipos de datos e interactuar directa o indirectamente con programas como \Pname{PAUP*}, \Pname{TNT} o \Pname{PhyML}. Sobre Windows usted cuenta con \Pname{WinClada} que funciona tanto en modo de manejo de edici\'on de matrices (\Gui {windada}) como en modo de edici\'on y manipulaci\'on de \'arboles. Adem\'as, le permite hacer b\'usquedas con NONA, tambi\'en puede usar la versi\'on de Windows de \Pname{TNT} que tiene interfaz gr\'afica. Si usa Mac una opci\'on es \Pname{McClade}, el cual funciona como \Pname{Mesquite} pero es m\'as veloz y eficiente, aunque es muy factible que no lo pueda usar con la versi\'on actual de Mac OS X.


Revise la secci\'on de Programas de c\'omputo para ver las instrucciones que utilizar\'ia con un programa distinto a \Pname{Winclada/NONA}. En todos los casos familiar\'icese con los men\'us e instrucciones para abrir/cerrar y editar tanto matrices como \'arboles, tenga en cuenta que los manuales de los programas traen informaci\'on adicional, por lo tanto su lectura es una muy buena opci\'on.

\preguntaGral{
\begin{enumerate}
	\item Si desea transformar de un formato de matriz a otro usando exclusivamente editor de texto, ?`cu\'ales son los pasos a seguir? Ensaye la lista construida con un ejemplo.

	\item Haga el listado de los aspectos comunes a todos los formatos de matrices.

	\item En el laboratorio anterior se insisti\'o en la claridad de los caracteres y sus estados. A la luz de los resultados obtenidos usando \'arboles y la matriz:

	\begin{enumerate}
		\item ?`puede usted conectar la importancia del an\'alisis de caracteres con la forma como se interpretan los cladogramas?
		\item Revise su bibliograf\'ia, y de ser posible compare trabajos con y sin matriz expl\'icita. ?`Puede notar alguna diferencia?
		\item ?`Cree que es una ventaja incluir y publicar la matriz, o por el contrario es una desventaja?\\ 
	\end{enumerate}

\end{enumerate}
}


\section*{Literatura recomendada} 

\cite{Maddison1997} [Una introducci\'on al formato NEXUS]. 

\cite{mesquite} [El programa m\'as vers\'atil para manipulaci\'on de matrices, por lo que la documentaci\'on DEBE ser le\'ida].

\cite{McClade4} [Aunque el programa no est\'e en uso, el manual presenta gran cantidad de informaci\'on b\'asica].

\cite{Neff1986} [Una de las primeras discusiones sobre el manejo de pesos en caracteres].
